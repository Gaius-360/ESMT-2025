<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin Dashboard — Avancé</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- CSS (voir fichier ci-dessous) -->
  <link rel="stylesheet" href="admin_dashboard.css" />
</head>
<body>
  <div class="dashboard">
    <button class="menu-toggle" style="color: red;background: none;" aria-label="Ouvrir menu"><i class="fa-solid fa-bars"></i></button>

    <aside class="sidebar">
      <h2>Espace Admin</h2>
      <button id="logoutBtn" class="btn-logout">Déconnexion</button>
      <nav>
        <ul>
          <li class="active"><a href="#"><i class="fa-solid fa-gauge-high"></i> Dashboard</a></li>
          <li><a href="../admin_etudiants/etudiants.html"><i class="fa-solid fa-users"></i> Étudiants</a></li>
          <li><a href="../admin_calendrier/admin_calendrier.html"><i class="fa-solid fa-calendar-days"></i> Calendrier</a></li>
          <li><a href="../admin_matieres/admin_matieres.html"><i class="fa-solid fa-book"></i> Matières</a></li>
          <li><a href="../admin_releve/admin_releve.html"><i class="fa-solid fa-file-lines"></i> Relevé</a></li>
          <li><a href="../admin_notes/admin_notes.html"><i class="fa-solid fa-chart-column"></i> Notes</a></li>
          <li><a href="../admin_absences/admin_absences.html"><i class="fa-solid fa-user-clock"></i> Absences</a></li>
          <li><a href="../admin_messages/admin_messages.html"><i class="fa-solid fa-envelope"></i> Messages</a></li>
          <li><a href="#" id="changePasswordLink"><i class="fa-solid fa-key"></i> Mot de passe</a></li>
        </ul>
      </nav>
    </aside>

    <main class="main">
      <!-- Fenêtre modale changer mot de passe -->
      <div id="passwordModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2>Changer votre mot de passe</h2>
          <form id="passwordForm">
            <input type="password" id="oldPassword" placeholder="Ancien mot de passe" required>
            <input type="password" id="newPassword" placeholder="Nouveau mot de passe" required>
            <input type="password" id="confirmPassword" placeholder="Confirmer le nouveau mot de passe" required>
            <button type="submit">Valider</button>
          </form>
          <p id="passwordMessage"></p>
        </div>
      </div>
      
      <header class="topbar">
        <h1>Tableau de bord — Statistiques</h1>

        <div class="controls">
          <select id="niveauFilter" aria-label="Filtrer par niveau">
            <option value="Licence 1">Licence 1</option>
            <option value="Licence 2">Licence 2</option>
            <option value="Licence 3 - RT">Licence 3 - RT</option>
            <option value="Licence 3 - ASR">Licence 3 - ASR</option>
          </select>

          <select id="semestreFilter" aria-label="Filtrer par semestre"></select>

          <label class="date-inline">De <input type="date" id="dateFrom"></label>
          <label class="date-inline">À <input type="date" id="dateTo"></label>

          <button id="applyFilters" class="btn primary">Appliquer</button>
          <button id="refreshBtn" class="btn">Rafraîchir</button>
        </div>
      </header>

      <!-- KPI -->
      <section class="kpi-grid" aria-label="KPIs principales">
        <div class="kpi">
          <div class="kpi-title">Étudiants (tout niveau confondu)</div>
          <div class="kpi-value" id="kpiStudents">—</div>
          <div class="kpi-sub" id="kpiStudentsChange"> </div>
        </div>

        <div class="kpi">
          <div class="kpi-title">Moyenne (semestre)</div>
          <div class="kpi-value" id="kpiAvg">—</div>
          <div class="kpi-sub" id="kpiAvgChange"> </div>
        </div>

        <div class="kpi">
          <div class="kpi-title">Total absences</div>
          <div class="kpi-value" id="kpiAbsences">—</div>
          <div class="kpi-sub" id="kpiAbsChange"> </div>
        </div>

        <div class="kpi">
          <div class="kpi-title">Taux de réussite</div>
          <div class="kpi-value" id="kpiPassRate">—</div>
          <div class="kpi-sub" id="kpiPassChange"> </div>
        </div>
      </section>

      <!-- Charts -->
      <section class="charts">
        <div class="chart-card">
          <h3>Évolution des moyennes</h3>
          <canvas id="chartEvolution" height="160"></canvas>
        </div>

       <section class="matiere-performance">
        <h3>Performance des matières</h3>
        <canvas id="matiereChart" width="400" height="200"></canvas>
       </section>


        <div class="chart-card">
          <h3>Absences — répartition</h3>
          <canvas id="chartAbsences" height="160"></canvas>
        </div>

         <!-- Recent actions -->
      <section class="recent">
        <h3>Actions récentes</h3>
        <ul id="recentList"></ul>
      </section>
      
      </section>

      <!-- Table top matières + export -->
      <section class="table-section">
        <div class="table-header">
          <h3>Matières (classement par moyenne)</h3>
          <div>
            <input type="text" id="searchSubject" placeholder="Rechercher matière..." />
            <button id="exportCsv" class="btn">Exporter CSV</button>
          </div>
        </div>

        <table class="data-table" id="subjectsTable" aria-label="Tableau matières">
          <thead>
            <tr>
              <th>Matière</th>
              <th>Coefficient</th>
              <th>Moyenne</th>
              <th>Validés</th>
              <th>Non validés</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

    </main>
  </div>

  <script src="admin_dashboard.js"></script>
</body>
</html>
